function PesonaMistar(X,U,T,b,k,L,o,j,Z){let baseId="BusurDerajat_B_"+X;let baseCanvas,baseContext;const m=b;const ah=k;const S=Math.PI;const u=Math.PI/2;const h=2*Math.PI;const aq=Math.PI/180;const J=180/Math.PI;let cPos={x:U,y:T};var af,ai;var x,aj;var ap;const N={NONE:0,GESER:1,PUTAR:2};var P=o;var G={margin:0,height:0,width:0,corner:0,p:[0,0,0,0],batas:0};var ae=false;const ac=200;var l=ac;var f=[0,0,0,0,0];var y;var q={x:m/2-L*j/2,y:ah/2};var c=0;var ak=false;K();al();n();this.loop=function(){if(ae){ae=false;n()}};this.redraw=function(){F();n()};this.visible=function(au){if(au){n();baseCanvas.style.visibility="visible";ak=true}else{baseCanvas.style.visibility="hidden";ak=false}};this.setPos=function(au){q.x=au.x;q.y=au.y;ae=true};this.setRotate=function(au){c=au;ae=true};function K(){var au=0;var ax=0;var av=m;var aw=ah;baseCanvas=document.createElement("canvas");baseContext=PesonaBasic.addCanvas(baseId,{canvas:baseCanvas,index:-1,x:au,y:ax,width:av,height:aw},true);F();if(!ak){baseCanvas.style.visibility="hidden"}baseCanvas.addEventListener("mousedown",ad);baseCanvas.addEventListener("touchstart",Y)}function F(){var au=PesonaBasic.getStage();af=au.pos.x;ai=au.pos.y;x=au.scale.x;aj=au.scale.y;ap=PesonaBasic.getAbsolutePosition(baseId)}function al(){G.margin=3.6*j;G.height=13.6*j;G.width=L*j+2*G.margin;G.corner=0.06*G.height;G.p[0]=0.18*G.height;G.p[1]=0.25*G.height;G.p[2]=0.4*G.height;G.p[3]=0.42*G.height;G.batas=G.margin+(L*30/100)*j;y=(AdaptiveFontSize.getVerticalCenteringDelta("100px CR","0"))/100}function n(){var aw=baseContext;aw.clearMe();aw.save();aw.translate(q.x,q.y);aw.rotate(c);var ax=G.corner;aw.beginPath();aw.roundedRect(-G.margin,0,G.width,G.height,ax);aw.closePath();aw.fillStyle=P;aw.fill();aw.lineWidth=1.2;aw.strokeStyle="rgba(0,0,0, 0.5)";aw.stroke();var ay;var au;aw.font=3*j+"px CRL";aw.textAlign="center";aw.textBaseline="top";aw.lineWidth=1.2;aw.strokeStyle="rgba(0,0,0, 0.8)";aw.fillStyle="#000000";aw.beginPath();for(var av=0;av<=L;av++){if(av%10==0){ay=G.p[2]}else{if(av%5==0){ay=G.p[1]}else{ay=G.p[0]}}au=av*j;aw.moveTo(au,0);aw.lineTo(au,ay);if(av%10==0){aw.fillText(av,au,G.p[3])}}aw.stroke();aw.lineWidth=1.2;aw.strokeStyle="rgba(0,0,0, 0.4)";au=G.batas-G.margin;aw.beginPath();aw.moveTo(au,G.height);aw.lineTo(au,G.height-G.p[1]);aw.stroke();var az=au+0.8*G.p[0];var aA=G.height-G.p[1]/2;var ax=0.3*G.p[0];aw.beginPath();aw.arc(az,aA,ax,0,h);aw.stroke();var az=au-0.8*G.p[0];aw.beginPath();aw.moveTo(az-ax,aA);aw.lineTo(az+ax,aA);aw.moveTo(az,aA-ax);aw.lineTo(az,aA+ax);aw.stroke();aw.restore()}function C(av,ay,aw,ax,az){const au=2;if(isFinite(aw)){return Math.abs((az-ay)-aw*(ax-av))<au}else{return Math.abs(ax-av)<au}}function w(av,ay,aw,ax,az){if(isFinite(aw)){const au=aw;const aB=-1;const aA=ay-aw*av;return Math.abs(au*ax+aB*az+aA)/Math.sqrt(au*au+aB*aB)}else{return Math.abs(ax-av)}}function B(av,aB,aD,ay,au){if(isFinite(aD)){const aA=1;const az=aD;const ax=ay-av;const aw=au-aB;const aC=(ax*aA+aw*az)/(aA*aA+az*az);return{x:av+aC*aA,y:aB+aC*az}}else{return{x:av,y:au}}}function at(av){var au=av;if(au<-S){au+=h}if(au>S){au-=h}return au}function aa(au){let a=((au%h)+h)%h;if(a>Math.PI){a-=h}return a}function W(av,au){let d=av-au;while(d<=-Math.PI){d+=2*Math.PI}while(d>Math.PI){d-=2*Math.PI}return d}function A(){var aA=M("letak",{id:X});var aB,ay;var aD,aC,au,az;var ax=false;for(var aw=0;aw<aA.length;aw++){aB=aA[aw].pos;aD=q.x-aB.x;aC=q.y-aB.y;au=Math.sqrt(aD*aD+aC*aC);if(au<10){q.x=aB.x;q.y=aB.y;ax=true}else{ay=aA[aw].slope;if(ay){az=w(aB.x,aB.y,ay,q.x,q.y);if(az<5){var av=B(aB.x,aB.y,ay,q.x,q.y);q.x=av.x;q.y=av.y;ax=true}}}if(ax){ae=true;break}}}function I(){var aC=M("putar",{id:X});var aA,az;var aB,av,au;const aD=1.5*aq;var ax=false;var ay=aa(c);for(var aw=0;aw<aC.length;aw++){aA=aC[aw].pos;az=aC[aw].slope;if(C(aA.x,aA.y,az,q.x,q.y)){if(isFinite(az)){aB=Math.atan(az)}else{aB=u}av=at(aB);au=at(aB-S);if(Math.abs(W(ay,av))<aD){c=av;ax=true}else{if(Math.abs(W(ay,au))<aD){c=au;ax=true}}}if(ax){ae=true;break}}}function r(az,ax){const aC=window.devicePixelRatio||1;var aD=(az-ap.x)*aC;var aB=(ax-ap.y)*aC;var ay={stat:false,type:0,delta:null};var av=baseContext;av.save();av.translate(q.x,q.y);av.rotate(c);var au=G.corner;av.beginPath();av.roundedRect(-G.margin,0,G.width,G.height,au);av.closePath();var aw=av.isPointInPath(aD,aB);if(aw){var aA={x:(az-af)/x,y:(ax-ai)/aj};ay.stat=true;av.beginPath();av.roundedRectExt(-G.margin,0,G.batas,G.height,au,0,0,au);av.closePath();aw=av.isPointInPath(aD,aB);if(aw){ay.type=0;ay.delta={x:aA.x-q.x,y:aA.y-q.y}}else{ay.type=1;var aF=aA.x-q.x;var aE=aA.y-q.y;ay.delta=Math.atan2(aE,aF)-c}}av.restore();return ay}var H;var ab=false;function e(){if(H=="mouse"){document.addEventListener("mouseup",Q)}else{document.addEventListener("touchend",V)}}function z(){if(H=="mouse"){document.removeEventListener("mouseup",Q)}else{document.removeEventListener("touchend",V)}}function Q(au){if(!au){var au=window.event}au.preventDefault();au.stopPropagation();if(au.button==R){document.removeEventListener("mousemove",ao);g(au,au)}}function V(au){if(!au){var au=window.event}au.preventDefault();au.stopPropagation();var av=au.changedTouches[0];if(av.identifier==s){document.removeEventListener("touchmove",ag);g(au,av)}}function g(aw,au){var av={x:au.pageX,y:au.pageY};var ay={x:(av.x-af)/x,y:(av.y-ai)/aj};z();var ax=mAction;mAction=N.NONE;switch(ax){case N.GESER:A();break;case N.PUTAR:if(c<-S){c+=h}if(c>S){c-=h}I();break}document.body.style.cursor="default";ab=false}var D;var v,t;var an,am;var p,ar;function ad(au){H="mouse";if(!au){var au=window.event}au.preventDefault();au.stopPropagation();if(au.buttons==undefined||au.buttons==1||au.buttons==2){R=au.button;E(au,au)}}var s;var R;function Y(au){H="touch";if(!au){var au=window.event}au.preventDefault();au.stopPropagation();if(au.targetTouches.length==1){var av=au.targetTouches[0];s=av.identifier;E(au,av)}}function E(ay,aE){var au={x:aE.pageX,y:aE.pageY};var aB={x:(au.x-af)/x-cPos.x,y:(au.y-ai)/aj-cPos.y};var ax=false;mAction=N.NONE;if(!ax){var aA=r(au.x,au.y);if(!aA.stat){switch(H){case"mouse":var az=M("mouseDown");if(az){const av=new MouseEvent(ay.type,{clientX:ay.clientX,clientY:ay.clientY,buttons:ay.buttons,button:ay.button,bubbles:true,cancelable:true});az.dispatchEvent(av)}break;case"touch":var az=M("touchStart");if(az){const aw=[];for(let i=0;i<ay.touches.length;i++){const aD=ay.touches[i];aw.push(new Touch({identifier:aD.identifier,target:az,clientX:aD.clientX,clientY:aD.clientY,screenX:aD.screenX,screenY:aD.screenY,pageX:aD.pageX,pageY:aD.pageY}))}const aC=new TouchEvent("touchstart",{touches:aw,targetTouches:aw,changedTouches:aw,bubbles:true,cancelable:true});az.dispatchEvent(aC)}break}}else{switch(aA.type){case 0:document.body.style.cursor="grab";an=aA.delta.x;am=aA.delta.y;mAction=N.GESER;break;case 1:document.body.style.cursor="pointer";p=aA.delta;mAction=N.PUTAR;break}}}if(mAction!=N.NONE){e();if(H=="mouse"){document.addEventListener("mousemove",ao)}else{document.addEventListener("touchmove",ag)}}}function ao(au){if(!au){var au=window.event}au.preventDefault();au.stopPropagation();O(au,au)}function ag(au){if(!au){var au=window.event}var av=au.changedTouches[0];if(av.identifier==s){au.preventDefault();au.stopPropagation();O(au,av)}}function O(az,ax){var ay={x:ax.pageX,y:ax.pageY};var aA={x:(ay.x-af)/x-cPos.x,y:(ay.y-ai)/aj-cPos.y};switch(mAction){case N.GESER:q.x=Math.min(m-20,Math.max(20,aA.x-an));q.y=Math.min(ah-20,Math.max(20,aA.y-am));ae=true;break;case N.PUTAR:var aw=aA.x-q.x;var av=aA.y-q.y;var au=(Math.atan2(av,aw)-p);c=au;ae=true;break}}function M(av,au){if(Z!=null){return Z.apply(this,[av,au])}else{return null}}};