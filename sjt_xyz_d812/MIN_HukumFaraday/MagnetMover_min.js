function MagnetMover(E,C,a,d,D){var e={x:E,y:C,w:a,h:d};var g=document.createElement("canvas");var u=PesonaBasic.addCanvas("MagMover_view",{canvas:g,index:-1,x:e.x,y:e.y,width:e.w,height:e.h},false);g.style.outline="none";g.style.backgroundColor="#f8f8f8";g.style.visibility="hidden";var j=true;var H=false;var G=a/2;var q=d/2;var f={pos:{x:0,y:0}};var n={pos:{x:0,y:0},rad:4,turn:5,gap:0.6,wireRad:0.12};var k=10;var A={length:10*k,margin:0.4*k,height:1.7*k};var z={rad:n.rad*k,gap:n.gap*k,wireRad:n.wireRad*k};var w=PesonaBasic.getStage();var l=w.scale.x;var I=w.scale.y;var L=PesonaBasic.getAbsolutePosition("MagMover_view");var o=false;r();this.loop=function(){if(o){o=false;r()}};this.redraw=function(){var x=PesonaBasic.getStage();l=x.scale.x;I=x.scale.y;L=PesonaBasic.getAbsolutePosition("MagMover_view");r()};this.visible=function(x){H=x;g.style.visibility="hidden"};function r(){var N=u;N.clearMe();var W,V;var M=3;var T=G-f.pos.x*k;var O=q;var R=A.length/2;var X=A.length/2+A.margin;var Q=A.height/2;var U=G+(-n.pos.x*k-0.5*(n.turn-1)*z.gap);var P=q;N.lineWidth=2*z.wireRad;N.lineCap="round";W=U;N.beginPath();for(var S=0;S<n.turn-1;S++){N.moveTo(W,q+z.rad);N.lineTo(W+z.gap,q-z.rad);W+=z.gap}N.strokeStyle="#cccccc";N.stroke();N.beginPath();N.moveTo(T,O-Q);N.arcTo(T+X,O-Q,T+X,O,M);N.arcTo(T+X,O+Q,T,O+Q,M);N.lineTo(T,O+Q);N.closePath();N.fillStyle="#aaaaaa";N.fill();N.beginPath();N.moveTo(T,O-Q);N.arcTo(T-X,O-Q,T-X,O,M);N.arcTo(T-X,O+Q,T,O-Q,M);N.lineTo(T,O+Q);N.closePath();N.fillStyle="#777777";N.fill();var M=2;N.beginPath();N.moveTo(T+R+M,O);N.arc(T+R,O,M,0,2*Math.PI);N.moveTo(T-R+M,O);N.arc(T-R,O,M,0,2*Math.PI);N.fillStyle="rgba(0,0,0,0.2)";N.fill();N.lineWidth=2*z.wireRad;N.lineCap="round";W=U;N.beginPath();for(var S=0;S<n.turn;S++){N.moveTo(W,q-z.rad);N.lineTo(W,q+z.rad);W+=z.gap}N.strokeStyle="#bbbbbb";N.stroke()}function i(T,R,x){var Q={stat:-1,dx:0};var P=G+(-n.pos.x*k-0.5*(n.turn-1)*z.gap);var M=q;if(T>=P-10&&T<=(P+(n.turn-1)*z.gap+10)&&R>=M-z.rad&&R<=M+z.rad){Q.stat=0;Q.dx=T-P;return Q}var O=G-f.pos.x*k;var y=q;var S=A.length/2+A.margin;var N=A.height/2;if(T>=O-S&&T<=O+S&&R>=y-N&&R<=y+N){Q.stat=1;Q.dx=T-O;return Q}return Q}var B;this.pointDown=function(N,M,y,O,x){B=x;return m(N,M,y,O,x)};function m(O,M,y,Q,x){if(j){var P=M-L.x;var N=y-L.y;return p(O,P,N,Q,x)}}this.pointUp=function(O,M,y,P,x){if(B==x){var N=F(O,M,y,P,x);return N}return false};function F(O,M,y,Q,x){var P=M-L.x;var N=y-L.y;return b(O,P,N,Q,x)}this.pointMove=function(N,M,y,O,x){return h(N,M,y,O,x)};function h(O,M,y,Q,x){var P=M-L.x;var N=y-L.y;return t(O,P,N,Q,x)}const v={NONE:0,MOVEMAGNET:1,MOVECOIL:2};var c;var K,J;function p(Q,R,P,y,x){c=v.NONE;var O=R/l;var M=P/I;var N=i(O,M,y);switch(N.stat){case 0:c=v.MOVECOIL;K=N.dx;return"moveCoil";break;case 1:c=v.MOVEMAGNET;K=N.dx;return"moveMagnet";break}}function t(N,R,P,x,S){var Q=R/l;var O=P/I;switch(c){case v.MOVEMAGNET:var y=Q-K;f.pos.x=Math.max(-20,Math.min(20,(G-y)/k));o=true;s("magnetPos",{pos:f.pos.x});break;case v.MOVECOIL:var M=Q-K;n.pos.x=Math.max(0,Math.min(15,(G-M-0.5*(n.turn-1)*z.gap)/k));o=true;s("coilPos",{pos:n.pos.x});break}}function b(N,O,M,y,x){c=v.NONE}function s(y,x){if(D!=null){D.apply(this,[y,x,this])}}};