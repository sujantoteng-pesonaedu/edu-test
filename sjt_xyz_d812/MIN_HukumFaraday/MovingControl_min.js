function MovingControl(N,G,ao,L,H,h,D,z,T){var f=500;var ac=100;const K="Movingcontrol_B_"+N.name;var E,U;var aa,ad;var p,ae;var al;let cPos={x:L,y:H};const d=2*Math.PI;const m=Math.PI/2;const O={x:f/2,y:ac/2};var S={center:{magnet:0,coil:0},amp:{magnet:0,coil:0},pos:{magnet:0,coil:0}};const I=5;const am=Math.PI/180;var r=[];const R={width:I*10,height:I*2};var P={rad:I*8,gap:I*0.4,turn:1,wireRad:I*0.12};const A={NONE:0,GESER:1};var Y=A.NONE;x();ah();J();function x(){E=document.createElement("canvas");U=PesonaBasic.addCanvas(K,{canvas:E,index:-1,x:L,y:H,width:f,height:ac},true);E.style.visibility="hidden";v();E.addEventListener("mousedown",Z);E.addEventListener("touchstart",Q)}function v(){var ap=PesonaBasic.getStage();aa=ap.pos.x;ad=ap.pos.y;p=ap.scale.x;ae=ap.scale.y;al=PesonaBasic.getAbsolutePosition(K)}function ah(){switch(ao){case 0:S.center.magnet={x:D.center.x,y:D.center.y};S.center.coil={x:0,y:0};S.amp.magnet=D.amp;S.amp.coil=0;S.pos.magnet=D.amp;S.pos.coil=0;r=[{x:0,y:0},{x:0,y:0}];break;case 1:S.center.magnet={x:D.center.x,y:D.center.y};S.center.coil=D.amp/2;S.amp.magnet=0;S.amp.coil=D.amp;S.pos.magnet=0;S.pos.coil={x:D.amp/2,y:0};r=[{x:0,y:0},{x:0,y:0}];break;case 2:S.center.magnet={x:D.center.x,y:D.center.y};S.center.coil=null;S.amp.magnet=null;S.amp.coil=null;S.pos.magnet={x:0,y:0};S.pos.coil={x:0,y:0};r=[{x:0,y:0}];break;case 3:S.center.magnet={x:D.center.x,y:D.center.y};S.center.coil=null;S.amp.magnet=null;S.amp.coil=null;S.pos.magnet={x:0,y:0};S.pos.coil={x:0,y:0};r=[{x:0,y:0}];break}}this.redraw=function(){v();J()};this.setCoilSize=function(ap,ar,aq){P.rad=I*ap;P.gap=I*ar;P.turn=aq;J()};this.setParameter=function(ap){switch(ao){case 0:S.center.magnet={x:ap.magnet.center,y:0};S.center.coil={x:0,y:0};S.amp.magnet=ap.magnet.amp;S.amp.coil=0;break;case 1:S.center.magnet={x:ap.magnet.center,y:0};S.center.coil=ap.coil.amp/2;S.amp.magnet=0;S.amp.coil=ap.coil.amp;break;case 2:S.center.magnet={x:ap.magnet.center,y:0};S.center.coil=0;S.amp.magnet=0;S.amp.coil=0;break;case 3:S.center.magnet={x:ap.magnet.center,y:0};S.center.coil=0;S.amp.magnet=0;S.amp.coil=0;break}J()};this.show=function(ap){if(ap){E.style.visibility="visible"}else{E.style.visibility="hidden"}};function W(aq,ap,ar){aq.beginPath();aq.roundRect(ap-R.width/2,ar-R.height/2,R.width,R.height,1.2);aq.fillStyle="#cccccc";aq.fill();aq.lineWidth=1.5;aq.strokeStyle="#888888";aq.stroke();aq.beginPath();aq.moveTo(ap,-R.height/2);aq.lineTo(ap,R.height/2);aq.stroke()}function af(ar,aC,az,aw,aB){var au=P.turn;var aA=(au-1)*P.gap;var aq=P.rad;var aE=0.01;var av=aC-(aA+2*aq*aE)/2;var aD=az;var ax=360*au;var ap,ay;var aG;var at=true;ar.beginPath();for(var aF=90;aF<=90+ax;aF++){a=aF*am;dx=aq*Math.sin(a)*aE;dy=aq*Math.cos(a);ap=av+aA*aF/ax+dx;ay=aD-dy;aG=aF%360;if(aB){if(aG>=0&&aG<180){if(at){ar.moveTo(ap,ay)}else{ar.lineTo(ap,ay)}at=false}else{at=true}}else{if(aG>=180){if(at){ar.moveTo(ap,ay)}else{ar.lineTo(ap,ay)}at=false}else{at=true}}}ar.lineWidth=1.2;ar.strokeStyle=aw;ar.stroke();if(aB){ar.beginPath();ar.arc(aC,az,3,0,d);ar.lineWidth=1.2;ar.strokeStyle="#333333";ar.stroke()}}function i(ar,au,aq,ap){ar.beginPath();ar.moveTo(aq,au+12);ar.lineTo(aq,au-6);ar.moveTo(ap,au+12);ar.lineTo(ap,au-6);ar.lineWidth=1;ar.strokeStyle="rgb(255, 102, 0)";ar.stroke();ar.beginPath();ar.moveTo(aq+5,au);ar.lineTo(ap-5,au);ar.lineWidth=1.5;ar.strokeStyle="rgb(255, 102, 0)";ar.stroke();var at=(aq+ap)/2;ar.beginPath();ar.moveTo(at,au-6);ar.lineTo(at,au+50);ar.lineWidth=1;ar.strokeStyle="rgb(255, 102, 0)";ar.setLineDash([5,2]);ar.stroke();ar.setLineDash([]);ar.beginPath();ar.moveTo(aq,au);ar.lineTo(aq+12,au-4);ar.lineTo(aq+12,au+4);ar.closePath();ar.fillStyle="rgb(255, 102, 0)";ar.fill();ar.beginPath();ar.moveTo(ap,au);ar.lineTo(ap-12,au-4);ar.lineTo(ap-12,au+4);ar.closePath();ar.fillStyle="rgb(255, 102, 0)";ar.fill()}function J(){var au=U;au.clearMe();au.save();au.translate(O.x,O.y);var ar=0.3;var aC,aB,ax;var av,at,aA;switch(ao){case 0:af(au,0,0,"#aaaaaa",false);av=(-S.center.magnet.x-S.amp.magnet)*I;at=(-S.center.magnet.x+S.amp.magnet)*I;W(au,av,0);W(au,at,0);r[0]=o(au,av,7,20,"#ffdd00");r[1]=o(au,at,7,20,"#ffdd00");af(au,0,0,"#666666",true);i(au,-22,av,at);break;case 1:av=-S.amp.coil*I;at=0;af(au,av,0,"#aaaaaa",false);af(au,at,0,"#aaaaaa",false);var ay=-S.center.magnet.x*I;W(au,ay,0);r[0]=o(au,ay,7,20,"#ffdd00");af(au,av,0,"#666666",true);af(au,at,0,"#666666",true);i(au,-22,av,at);r[1]=o(au,av,0,10,"#ffdd00");break;case 2:var ay=-S.center.magnet.x*I;af(au,0,0,"#aaaaaa",false);W(au,ay,0);au.beginPath();au.arc(ay,0,R.width/2,-35*am,Math.PI,true);au.lineWidth=1.5;au.strokeStyle="rgba(255, 102, 0, 0.7)";au.stroke();au.beginPath();au.arc(ay,0,R.width/2,145*am,0,true);au.stroke();var aq=ay-R.width/2;au.beginPath();au.moveTo(aq,12);au.lineTo(aq-4,0);au.lineTo(aq+4,0);au.closePath();au.fillStyle="rgba(255, 102, 0, 0.7)";au.fill();aq=ay+R.width/2;au.beginPath();au.moveTo(aq,-12);au.lineTo(aq-4,0);au.lineTo(aq+4,0);au.closePath();au.fill();r[0]=o(au,ay,7,20,"#ffdd00");af(au,0,0,"#666666",true);break;case 3:var ay=-S.center.magnet.x*I;af(au,0,0,"#aaaaaa",false);W(au,ay,0);r[0]=o(au,ay,7,20,"#ffdd00");af(au,0,0,"#666666",true);var aw=(P.turn-1)*P.gap/2;var ap=Math.sqrt(P.rad*P.rad+aw*aw)+P.wireRad/2;au.beginPath();au.arc(0,0,ap,-125*am,-270*am,true);au.lineWidth=1.5;au.strokeStyle="rgba(255, 102, 0, 0.7)";au.stroke();au.beginPath();au.arc(0,0,ap,-305*am,-m,true);au.stroke();var az=ap;au.beginPath();au.moveTo(12,az);au.lineTo(0,az-4);au.lineTo(0,az+4);au.closePath();au.fillStyle="rgba(255, 102, 0, 0.7)";au.fill();au.beginPath();au.moveTo(-12,-az);au.lineTo(0,-az-4);au.lineTo(0,-az+4);au.closePath();au.fill();break}au.restore()}function o(ar,ap,av,at,aq){ar.beginPath();ar.moveTo(ap,av);ar.lineTo(ap,av+at);ar.lineWidth=1.6;ar.strokeStyle="#555555";ar.stroke();var au=av+at;ar.beginPath();ar.moveTo(ap,au+18);ar.arcTo(ap-12,au+18,ap,au-3,2);ar.arcTo(ap,au-3,ap+12,au+18,2);ar.arcTo(ap+12,au+18,ap,au+18,2);ar.closePath();ar.save();ar.shadowColor="rgba(0,0,0,0.4)";ar.shadowBlur=2;ar.shadowOffsetX=4;ar.shadowOffsetY=3;ar.fillStyle=aq;ar.fill();ar.restore();ar.lineCap="round";ar.lineWidth=1;ar.strokeStyle="#000000";ar.stroke();return{x:ap,y:au}}function l(au,ar){var ap=U;const az=window.devicePixelRatio||1;var aA=(au-al.x)*az;var ax=(ar-al.y)*az;ap.save();ap.translate(O.x,O.y);var at={stat:false,n:-1,dx:0};var ay,av;for(var aq=r.length-1;aq>=0;aq--){ay=r[aq].x;av=r[aq].y;if(w=="mouse"){ap.beginPath();ap.moveTo(ay,av+18);ap.arcTo(ay-12,av+18,ay,av-3,2);ap.arcTo(ay,av-3,ay+12,av+18,2);ap.arcTo(ay+12,av+18,ay,av+18,2);ap.closePath()}else{ap.beginPath();ap.rect(ay-15,av-10,30,38)}if(ap.isPointInPath(aA,ax)){var aw=(au-aa)/p-cPos.x;at.stat=true;at.n=aq;at.dx=aw-(ay+O.x);break}}ap.restore();return at}var ag,u;function e(ap){switch(ao){case 0:ag=S.center.magnet.x;u=(ap==0)?ag-S.amp.magnet:ag+S.amp.magnet;break;case 1:case 2:case 3:break}}function V(ax,aw,ar){switch(ao){case 0:var aq=(ax.x-ar)-O.x;aq=Math.min(Math.max(aq,-22*I),22*I);var au=-aq/I;au=Math.round(au*10)/10;var at=Math.abs(u-au)/2;var av=1;if(at<av){at=av;au=(aw==0)?u+2*at:u-2*at}var ap=(aw==0)?au<u:au>u;if(!ap){S.amp.magnet=at;S.center.magnet.x=(au+u)/2;J();y("setMovingParameter",{type:0,atr:S})}break;case 1:var aq=(ax.x-ar)-O.x;if(aw==0){aq=Math.min(Math.max(aq,-22*I),22*I);var au=-aq/I;au=Math.round(au*10)/10;S.center.magnet.x=au}else{aq=Math.min(Math.max(aq,-22*I),0);var au=-aq/I;au=Math.round(au*10)/10;S.amp.coil=Math.max(au,2)}J();y("setMovingParameter",{type:1,atr:S});break;case 2:var aq=(ax.x-ar)-O.x;aq=Math.min(Math.max(aq,-22*I),22*I);var au=-aq/I;au=Math.round(au*10)/10;S.center.magnet.x=au;J();y("setMovingParameter",{type:2,atr:S});break;case 3:var aq=(ax.x-ar)-O.x;aq=Math.min(Math.max(aq,-22*I),22*I);var au=-aq/I;au=Math.round(au*10)/10;S.center.magnet.x=au;J();y("setMovingParameter",{type:3,atr:S})}}var w;var X=false;function b(){if(w=="mouse"){document.addEventListener("mouseup",C)}else{document.addEventListener("touchend",M)}}function q(){if(w=="mouse"){document.removeEventListener("mouseup",C)}else{document.removeEventListener("touchend",M)}}function C(ap){if(!ap){var ap=window.event}ap.preventDefault();ap.stopPropagation();if(ap.button==F){document.removeEventListener("mousemove",ak);c(ap,ap)}}function M(ap){if(!ap){var ap=window.event}ap.preventDefault();ap.stopPropagation();var aq=ap.changedTouches[0];if(aq.identifier==j){document.removeEventListener("touchmove",ab);c(ap,aq)}}function c(ar,ap){var aq={x:ap.pageX,y:ap.pageY};var at={x:(aq.x-aa)/p,y:(aq.y-ad)/ae};q();if(Y==A.GESER){y("movingRelease",{type:0,atr:S})}Y=A.NONE;document.body.style.cursor="default";X=false}var s;var n,k;var aj,ai;var g,an;function Z(ap){w="mouse";if(!ap){var ap=window.event}ap.preventDefault();ap.stopPropagation();if(ap.buttons==undefined||ap.buttons==1||ap.buttons==2){F=ap.button;t(ap,ap)}}var j;var F;function Q(ap){w="touch";if(!ap){var ap=window.event}ap.preventDefault();ap.stopPropagation();if(ap.targetTouches.length==1){var aq=ap.targetTouches[0];j=aq.identifier;t(ap,aq)}}function t(av,ap){var ar={x:ap.pageX,y:ap.pageY};var aw={x:(ar.x-aa)/p-cPos.x,y:(ar.y-ad)/ae-cPos.y};const at=window.devicePixelRatio||1;var au=false;Y=A.NONE;var aq=l(ar.x,ar.y);if(aq.stat){document.body.style.cursor="pointer";s=aq.n;aj=aq.dx;e(aq.n);Y=A.GESER}if(Y!=A.NONE){b();if(w=="mouse"){document.addEventListener("mousemove",ak)}else{document.addEventListener("touchmove",ab)}}}function ak(ap){if(!ap){var ap=window.event}ap.preventDefault();ap.stopPropagation();B(ap,ap)}function ab(ap){if(!ap){var ap=window.event}var aq=ap.changedTouches[0];if(aq.identifier==j){ap.preventDefault();ap.stopPropagation();B(ap,aq)}}function B(ar,ap){var aq={x:ap.pageX,y:ap.pageY};var at={x:(aq.x-aa)/p-cPos.x,y:(aq.y-ad)/ae-cPos.y};switch(Y){case A.GESER:V(at,s,aj);break}}function y(aq,ap){if(T!=null){return T.apply(this,[aq,ap])}else{return null}}};